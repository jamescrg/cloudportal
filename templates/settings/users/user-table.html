<div class="card-title flex-center-space">
    <h1>User Management</h1>
    <div style="display:flex;gap:0.5rem">
        <button class="square-button"
                hx-get="{% url 'settings-add-user' %}"
                hx-target="#htmx-modal-container">
            <i class="icon-plus"></i>
        </button>
        <button class="square-button filter-button"
                hx-get="{% url 'settings-user-filter' %}"
                hx-target="#htmx-modal-container">
            <i class="icon-list-filter"></i>
        </button>
    </div>
</div>
<div class="table-container">
    <table class="table">
        <tr>
            <th>
                Username
                <button class="btn-sort {% if 'username' in current_order %}active{% endif %}"
                        hx-get="{% url 'settings-user-sort' 'username' %}"
                        hx-target="this">
                    <i class="icon-chevrons-up-down"></i>
                </button>
            </th>
            <th>Name</th>
            <th>
                Email
                <button class="btn-sort {% if 'email' in current_order %}active{% endif %}"
                        hx-get="{% url 'settings-user-sort' 'email' %}"
                        hx-target="this">
                    <i class="icon-chevrons-up-down"></i>
                </button>
            </th>
            <th>
                Role
                <button class="btn-sort {% if 'role' in current_order %}active{% endif %}"
                        hx-get="{% url 'settings-user-sort' 'role' %}"
                        hx-target="this">
                    <i class="icon-chevrons-up-down"></i>
                </button>
            </th>
            <th>
                Active
                <button class="btn-sort {% if 'is_active' in current_order %}active{% endif %}"
                        hx-get="{% url 'settings-user-sort' 'is_active' %}"
                        hx-target="this">
                    <i class="icon-chevrons-up-down"></i>
                </button>
            </th>
        </tr>
        {% for u in users %}
            <tr>
                <td>
                    <div class="dropdown" x-data="dropdown()">
                        <a href="#"
                           class="dropdown-trigger"
                           x-ref="button"
                           @click.prevent="toggle()"
                           :aria-expanded="open">{{ u.username }}</a>
                        <ul class="dropdown-menu" x-ref="menu" x-show="open" @click="close()">
                            <li>
                                <a class="dropdown-item"
                                   href="#"
                                   hx-get="{% url 'settings-edit-user' u.id %}"
                                   hx-target="#htmx-modal-container">
                                    <i class="icon-pencil"></i> Edit
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item"
                                   href="#"
                                   hx-post="{% url 'settings-switch-status' u.id %}">
                                    <i class="icon-toggle-right"></i> Switch Status
                                </a>
                            </li>
                        </ul>
                    </div>
                </td>
                <td>{{ u.get_full_name }}</td>
                <td>{{ u.email }}</td>
                <td>
                    <div class="dropdown" x-data="dropdown()">
                        <a href="#"
                           class="dropdown-trigger"
                           x-ref="button"
                           @click.prevent="toggle()"
                           :aria-expanded="open">{{ u.get_role_display }}</a>
                        <ul class="dropdown-menu" x-ref="menu" x-show="open" @click="close()">
                            <li>
                                <a class="dropdown-item {% if u.role == 'USER' %}active{% endif %}"
                                   href="#"
                                   hx-post="{% url 'settings-change-role' u.id 'USER' %}">User</a>
                            </li>
                            <li>
                                <a class="dropdown-item {% if u.role == 'ADMIN' %}active{% endif %}"
                                   href="#"
                                   hx-post="{% url 'settings-change-role' u.id 'ADMIN' %}">Admin</a>
                            </li>
                        </ul>
                    </div>
                </td>
                <td>
                    {% if u.is_active %}
                        <i class="icon-circle-check"></i>
                    {% else %}
                        <i class="icon-circle-x"></i>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="5" class="empty-message">No users found.</td>
            </tr>
        {% endfor %}
    </table>
</div>
{% include "pagination.html" %}
